# 飞剑模块重构｜红线文档（Constraints）

> 本文规定禁止项与硬性边界，违反将被视为阻断上线的红线问题。

## 1. 技术选型禁止
- ❌ 新增第三方依赖/大型框架（除非经评审与基准验证）
- ❌ 使用 `FMLJavaModLoadingContext` 进行事件注册（NeoForge 下改为构造函数注册）
- ❌ 直接访问/修改 Minecraft 客户端类于服务端路径
- ❌ 直接操作 `LinkageManager`、`LinkageChannel.adjust`、`ledger.remove`（改用 `ResourceOps`/`LedgerOps`）

## 2. 架构模式禁止
- ❌ 在 Entity.tick/hurt 内进行阻塞 I/O、网络或磁盘操作
- ❌ 在钩子中执行长耗时计算或无限循环；Registry 内不可抛出未捕获异常
- ❌ 无界集合/缓存（必须有上限或过期策略）
- ❌ 静态全局可变状态作为业务真源（状态应存附件或实体数据）

## 3. 代码实践禁止
- ❌ 直接新建线程/定时器管理游戏逻辑（使用已有调度/服务器任务队列）
- ❌ 在服务端逻辑中引用客户端渲染/资源管理类
- ❌ 在事件回调中修改非本事件约束范围内的数据（越界副作用）
- ❌ 大量日志（INFO 以上）影响性能；默认需静音

## 4. 安全红线
- ❌ 信任客户端传入的任何未校验数据（命令/网络包必须校验）
- ❌ 将玩家 UUID、名称等隐私数据写入公共日志
- ❌ 未加边界检查的 NBT 读写导致崩溃/注入

## 5. 性能红线
- ❌ 每 tick 重复范围查询（目标搜索需黑板/缓存合并）
- ❌ 事件钩子累计执行时间超预算且无熔断/开关
- ❌ 大量小包网络风暴；粒子/音效刷屏

## 6. 资源与冷却一致性
- ❌ 非 `ResourceOps` 路径的资源消耗与恢复
- ❌ 分散/重复冷却计时（冷却集中 `MultiCooldown`）

## 7. 兼容与迁移
- ❌ 未文档化的破坏性变更（包名、类名、事件字段）
- ❌ 未提供回退策略即默认启用高风险功能

