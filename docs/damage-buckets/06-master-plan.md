# 总任务文档（Master Plan）— OnHit 聚合接口与伤害桶

## 项目目标
- 为 OnHit 管线引入统一乘区的聚合机制，提升数值可控性与一致性，同时保证兼容与灰度能力。

## 里程碑与交付物
- M1：聚合接口与上下文落地；开关默认关闭；文档齐备。
- M2：开启聚合开关后，示例贡献者验证通过；测试覆盖完善；调试开关可用。
- M3：准备迁移阶段（本计划不包含迁移实施），沉淀最佳实践与模板。

## 成功标准
- 关闭开关时，编译与测试通过，线上行为零差异。
- 开启开关时，聚合数学正确（同乘区一次应用），兼容期无重复结算。

## 关键依赖
- 现有 OnHit 事件接入点 `OrganDefenseEvents` 与 `ChestCavityUtil.onHit`。
- 配置系统（可复用 ChestCavity 现有 Config）。

## 风险清单
- 与旧监听器重复增伤 -> 标记/跳过机制到位。
- 性能 -> O(n) 扫描，默认无日志；必要时压测。

