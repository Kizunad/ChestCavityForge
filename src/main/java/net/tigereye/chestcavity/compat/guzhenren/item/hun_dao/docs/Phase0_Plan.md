# Phase 0 实施计划：基线与观测

## 1. 阶段目标
- 锁定当前 hun_dao 功能基线，建立可快速验证的测试机制
- 输出现状依赖图、魂魄流转路径、smoke 测试脚本
- 建立后续阶段的计划-报告-验收流程模板

## 2. 任务清单

### 2.1 现状分析与文档 (预计 2-3 小时)
- [x] **T0.1** 探索 hun_dao 包完整结构
  - 责任：AI Assistant
  - 输出：完整目录树 + 28 个类的位置与职责
  - 完成标志：已获取所有 Java 文件的路径和基本功能描述

- [ ] **T0.2** 绘制依赖关系图
  - 责任：AI Assistant
  - 范围：
    - HunDaoMiddleware 与行为类的调用关系
    - SoulBeastRuntimeEvents 与各组件的事件流
    - 魂魄资源流转路径（生成 → 存储 → 消耗）
    - 魂兽化状态机与触发条件
  - 输出：`Phase0_Report.md` 中的"依赖关系图"章节（文本描述或 Mermaid 图）
  - 完成标志：能清晰展示 3 条关键路径（魂焰 DoT、伤害转化、魂兽化仪式）

- [ ] **T0.3** 盘点核心功能清单
  - 责任：AI Assistant
  - 范围：
    - 4 个器官的所有能力（被动/主动/联动）
    - 魂兽化仪式流程
    - 魂焰 DoT 机制
    - 伤害转化与魂魄消耗
    - 资源管理（魂魄生成/泄露/上限提升）
  - 输出：`Phase0_Report.md` 中的"功能基线清单"章节
  - 完成标志：覆盖所有现有功能，标注关键代码位置

### 2.2 Smoke 测试设计 (预计 1-2 小时)
- [ ] **T0.4** 设计手动测试场景
  - 责任：AI Assistant
  - 场景：
    1. **魂兽化仪式**：装备小魂蛊 + 大魂蛊 → 执行命令 → 验证状态切换
    2. **魂魄生成与消耗**：观察魂魄值变化 → 近战攻击 → 验证魂焰 DoT
    3. **伤害转化**：魂兽状态受击 → 验证魂魄扣减与血量变化
    4. **器官联动**：装备特定器官组合 → 验证加成效果
  - 输出：`smoke_test_script.md`（命令序列 + 验证指标）
  - 完成标志：每个场景包含准备步骤、执行命令、预期结果

- [ ] **T0.5** 创建验证检查清单
  - 责任：AI Assistant
  - 范围：
    - 魂兽化状态标志检查
    - 魂魄值数值验证
    - DoT 效果持续时间检查
    - 伤害转化比例验证
  - 输出：`smoke_test_script.md` 中的"验收检查表"
  - 完成标志：每个场景有明确的成功/失败判定标准

### 2.3 报告模板建立 (预计 0.5 小时)
- [ ] **T0.6** 创建 Phase0_Report.md 模板
  - 责任：AI Assistant
  - 结构：
    1. 执行摘要
    2. 依赖关系图
    3. 功能基线清单
    4. Smoke 测试结果
    5. 遗留问题与风险
    6. 下一步建议
  - 输出：`Phase0_Report.md`（模板形式）
  - 完成标志：结构完整，占位符清晰

- [ ] **T0.7** 创建 Phase0_Review.md 模板
  - 责任：AI Assistant
  - 结构：
    1. 审查结论（通过/条件通过/不通过）
    2. 问题清单
    3. 修改建议
    4. 验收签名
  - 输出：`Phase0_Review.md`（模板形式）
  - 完成标志：提供审查标准和反馈机制

### 2.4 验证与交付 (预计 0.5 小时)
- [ ] **T0.8** 执行 Smoke 测试
  - 责任：需要人工配合（AI 提供脚本，人工执行游戏内操作）
  - 执行：按 `smoke_test_script.md` 进行手动测试
  - 输出：填写 `Phase0_Report.md` 中的测试结果
  - 完成标志：所有场景测试完成，记录成功/失败

- [ ] **T0.9** 提交 Phase 0 文档
  - 责任：AI Assistant
  - 范围：
    - `Phase0_Plan.md`（本文档）
    - `Phase0_Report.md`（包含测试结果）
    - `Phase0_Review.md`（待审查模板）
    - `smoke_test_script.md`（测试脚本）
  - 输出：Git commit + push
  - 完成标志：所有文档提交到 `claude/hun-dao-rearchitecture-01NDLBRc4GgwytEywd7DXyFE` 分支

## 3. 时间表
| 任务 | 预计耗时 | 依赖 | 状态 |
|------|----------|------|------|
| T0.1 | 1 小时 | - | ✅ 已完成 |
| T0.2 | 1 小时 | T0.1 | ⏳ 待开始 |
| T0.3 | 1 小时 | T0.1 | ⏳ 待开始 |
| T0.4 | 1 小时 | T0.3 | ⏳ 待开始 |
| T0.5 | 0.5 小时 | T0.4 | ⏳ 待开始 |
| T0.6 | 0.5 小时 | T0.2, T0.3 | ⏳ 待开始 |
| T0.7 | 0.5 小时 | - | ⏳ 待开始 |
| T0.8 | 1 小时 | T0.4, T0.5 | ⏳ 待开始（需人工） |
| T0.9 | 0.5 小时 | T0.6, T0.7 | ⏳ 待开始 |

**总计**：约 6-7 小时（AI 自动化部分 5-6 小时，人工测试部分 1 小时）

## 4. 验收标准
- [ ] 依赖关系图覆盖 3 条关键路径（魂焰 DoT、伤害转化、魂兽化仪式）
- [ ] 功能基线清单包含所有现有功能，标注代码位置
- [ ] Smoke 测试脚本包含 4 个场景，每个场景有明确的验收标准
- [ ] 测试结果记录完整，标记成功/失败与问题描述
- [ ] 建立计划-报告-审查模板，供后续阶段使用

## 5. 风险与应对
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 依赖关系过于复杂，难以图形化 | 中 | 使用文本描述 + Mermaid 简化图，聚焦关键路径 |
| 手动测试需要人工配合 | 中 | 提供详细的测试脚本，降低执行难度 |
| 功能清单遗漏 | 低 | 基于代码探索结果，交叉验证行为类与资源文件 |

## 6. 下一步（Phase 1 准备）
- 基于 Phase 0 的依赖分析，设计接口骨架（HunDaoResourceOps, HunDaoFxOps 等）
- 参考 `jian_dao` 包结构，规划 `runtime/`, `calculator/`, `tuning/` 等目录
- 准备 Phase 1 的 Plan 文档

---
**计划创建时间**：2025-11-17
**执行人员**：AI Assistant + 人工配合测试
**预计完成时间**：6-7 小时内
