# Phase 0.1 迭代计划：Smoke 缺陷回补

## 1. 阶段目标
- 修复 Phase 0 smoke 测试暴露的 2 个缺陷，确保基线与客户端反馈一致。
- 回填测试脚本勾选项，更新 Phase 0 报告与审查记录。

## 2. 缺陷列表
| 编号 | 缺陷描述 | 来源 | 优先级 |
|------|----------|------|--------|
| D0.1 | 魂焰 DoT 缺少粒子特效与音效播放，玩家无法获得反馈（smoke_test_script.md:160-165） | Phase0 smoke | P1 |
| D0.2 | 双大魂蛊 + 小魂蛊时威灵减免未生效，近战攻击仍消耗 18 魂魄（smoke_test_script.md:117-123） | Phase0 smoke | P1 |

## 3. 任务分解

### T0.1：魂焰 FX/音效恢复
- **目标**：在服务器触发魂焰 DoT 时，客户端能看到粒子、听到音效。
- **范围**
  - 排查 `HunDaoMiddleware`、`HunDaoClientAbilities`、FX 注册路径，确认魂焰事件是否向客户端广播。
  - 如无现成 FX 管线，先实现最小版：服务端 `SoulBeastRuntimeEvents` 发送粒子/音效 Packet，客户端监听播放（可临时借用 `jian_dao/fx/JianQiGuFx` 模式）。
  - 调整 `smoke_test_script.md` 中的验收记录，并提供日志或截图说明。
- **输出**
  - 代码补丁 + `docs/Phase0_Report.md` 的问题修复记录。
  - 更新后的 smoke 测试结果（勾选 FX/音效项）。
- **验收**
  - 手动测试时肉眼可见粒子；`CUSTOM_SOULBEAST_DOT` 或等效音效触发一次。

### T0.2：大魂蛊威灵减免逻辑修复
- **目标**：装备 2 个大魂蛊 + 小魂蛊 时，攻击魂魄消耗应降低至 8（含威灵减免）。
- **范围**
  - 检查 `HunDaoDamageUtil` 或行为层的魂魄扣减逻辑，验证威灵累加是否被覆盖/未启用。
  - 为威灵减免添加单元测试或最小验证方法。
  - 更新 `smoke_test_script.md` 的勾选与备注。
- **输出**
  - 修复代码 + 数值验证说明。
- **验收**
  - 实机测试显示攻击前后魂魄差值为 8；DEBUG 日志记录减免计算。

### T0.3：文档与审查更新
- **目标**：反映 Phase0.1 结果。
- **范围**
  - 更新 `Phase0_Report.md` "Smoke 测试结果" 章节，记录已修复缺陷与验证截图/日志。
  - 更新 `Phase0_Review.md` 版本条目（若需二次审查）。
  - 归档 `smoke_test_script.md` 中的测试日期、签名。

## 4. 时间线
| 日期 | 事项 |
|------|------|
| D+0 | 确认任务、拉取最新代码 |
| D+1 | 完成魂焰 FX/音效修复并验证 |
| D+2 | 完成威灵减免修复并验证 |
| D+2 | 更新 smoke 测试 & 报告，提交 Phase0.1 审查 |

## 5. 验收标准
- 两个缺陷均在 smoke 脚本中勾选通过，并有测试截图/日志佐证。
- `docs/` 内相关报告更新完毕，Phase 0 进入“✅ 通过”状态。
- 无新增阻塞问题，方可开始 Phase 1。

## 6. 风险与对策
- **客户端粒子注册复杂** → 暂采用通用粒子/音效，待 Phase 5 再细化 FX。
- **威灵逻辑深入行为层** → 优先添加单元测试，避免回归。

---
完成上述任务后，再次提交 Phase 0 审查以确认完全通过。
