# æ¶æ„é‡æ„ï¼šä»ç‰©å“æ¨¡å¼è¿ç§»åˆ°å™¨å®˜æ¨¡å¼

**æ—¥æœŸ**: 2025-11-14
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: ğŸŸ¡ è¿›è¡Œä¸­ï¼ˆæ¡†æ¶å®Œæˆï¼Œé€»è¾‘å¾…å®ç°ï¼‰

---

## ğŸ“‹ é‡æ„æ¦‚è¿°

### é‡æ„åŸå› 
1. **æ¶æ„ä¸€è‡´æ€§**: jian_daoæ¨¡å—çš„å…¶ä»–è›Šè™«ï¼ˆå‰‘å½±è›Šã€å‰‘å¼•è›Šç­‰ï¼‰éƒ½æ˜¯é€šè¿‡å™¨å®˜ç³»ç»Ÿå®ç°ï¼Œå¤šé‡å‰‘å½±è›Šåº”ä¿æŒä¸€è‡´
2. **è®¾è®¡æ¾„æ¸…**: ç”¨æˆ·æ˜ç¡®æŒ‡å‡º"åº”è¯¥æ˜¯èƒ¸è…”å†…éƒ¨é€»è¾‘ï¼Œä¸æ˜¯item"
3. **ç‰©å“æ¥æº**: guzhenrenæ¨¡ç»„å·²æä¾› `duochongjianying` ç‰©å“ï¼Œæ— éœ€ChestCavityé‡å¤æ³¨å†Œ

### æ¶æ„å¯¹æ¯”

| ç»´åº¦ | åŸæ¶æ„ï¼ˆç‰©å“æ¨¡å¼ï¼‰ | æ–°æ¶æ„ï¼ˆå™¨å®˜æ¨¡å¼ï¼‰ |
|------|-------------------|-------------------|
| **ç‰©å“æ³¨å†Œ** | `chestcavity:duochongjianying_gu`<br/>ï¼ˆå†…éƒ¨æ³¨å†Œï¼Œè‡ªå®šä¹‰ç‰©å“ç±»ï¼‰ | `guzhenren:duochongjianying`<br/>ï¼ˆå¤–éƒ¨å¼•ç”¨ï¼Œguzhenrenæä¾›ï¼‰ |
| **åŠŸèƒ½å®ç°** | `DuochongjianyingGuItem.java`<br/>ï¼ˆ460è¡Œï¼Œå®ç° `Item` æ¥å£ï¼‰ | `DuochongjianyingGuOrganBehavior.java`<br/>ï¼ˆå™¨å®˜è¡Œä¸ºæšä¸¾ï¼‰ |
| **è§¦å‘æ–¹å¼** | å³é”®ç‰©å“ï¼ˆç‰©å“åœ¨æ‰‹ä¸­æˆ–èƒŒåŒ…ï¼‰ | ä¸»åŠ¨æŠ€èƒ½ï¼ˆè›Šè™«åœ¨èƒ¸è…”ä¸­ï¼‰ |
| **çŠ¶æ€å­˜å‚¨** | ç‰©å“NBT (`DataComponents.CUSTOM_DATA`) | å™¨å®˜çŠ¶æ€ (`OrganState`) |
| **æ³¨å†Œä½ç½®** | `CCItems.java` | `JiandaoOrganRegistry.java` |
| **ç¿»è¯‘é”®** | ~~`item.chestcavity.duochongjianying_gu`~~ | `item.guzhenren.duochongjianying` âœ… |

---

## ğŸ”„ è¿ç§»æ­¥éª¤

### ç¬¬1æ­¥ï¼šä¿®æ”¹ç‰©å“æ³¨å†Œ âœ…
**æ–‡ä»¶**: `CCItems.java`

```java
// âŒ åˆ é™¤ï¼ˆåŸæ–¹å¼ï¼‰
public static final DeferredItem<DuochongjianyingGuItem> DUOCHONGJIANYING_GU =
    ITEMS.register("duochongjianying_gu", DuochongjianyingGuItem::new);

// âœ… æ–°å¢ï¼ˆæ–°æ–¹å¼ï¼‰
public static final Item GUZHENREN_DUOCHONGJIANYING =
    resolveExternalItem("guzhenren", "duochongjianying");
```

**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆæäº¤å¾…å®šï¼‰

---

### ç¬¬2æ­¥ï¼šåˆ›å»ºå™¨å®˜è¡Œä¸ºç±» âœ…
**æ–‡ä»¶**: `behavior/organ/DuochongjianyingGuOrganBehavior.java`

**ç±»è®¾è®¡**:
```java
public enum DuochongjianyingGuOrganBehavior {
  INSTANCE;

  // å™¨å®˜ID: guzhenren:duochongjianying
  // ä¸»åŠ¨æŠ€èƒ½ID: guzhenren:duochongjianying_fenshen

  static {
    // æ³¨å†Œä¸»åŠ¨æŠ€èƒ½æ¿€æ´»ç›‘å¬å™¨
    OrganActivationListeners.register(ABILITY_ID,
        DuochongjianyingGuOrganBehavior::activateAbility);
  }

  // ä¸»åŠ¨æŠ€èƒ½å›è°ƒ
  private static void activateAbility(Player player,
      ChestCavityInstance cc, ItemStack organ) {
    // TODO: å®ç°å¬å”¤/å¬å›é€»è¾‘
  }

  // å™¨å®˜é™„åŠ æ—¶åˆå§‹åŒ–
  public void ensureAttached(ChestCavityInstance cc, ItemStack organ) {
    // TODO: åˆå§‹åŒ–æ‰€æœ‰è€…UUID
  }
}
```

**çŠ¶æ€**: âœ… æ¡†æ¶å®Œæˆï¼ŒTODOæ ‡è®°å¾…å®ç°

---

### ç¬¬3æ­¥ï¼šæ³¨å†Œåˆ°å™¨å®˜ç³»ç»Ÿ âœ…
**æ–‡ä»¶**: `JiandaoOrganRegistry.java`

```java
private static final List<OrganIntegrationSpec> SPECS = List.of(
    // ... å…¶ä»–è›Šè™« ...

    // å¤šé‡å‰‘å½±è›Šï¼šä¸»åŠ¨æŠ€èƒ½è§¦å‘åˆ†èº«å¬å”¤/å¬å›
    OrganIntegrationSpec.builder(
            ResourceLocation.fromNamespaceAndPath("guzhenren", "duochongjianying"))
        .ensureAttached(DuochongjianyingGuOrganBehavior.INSTANCE::ensureAttached)
        .build()
);
```

**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### ç¬¬4æ­¥ï¼šè¿ç§»æ ¸å¿ƒé€»è¾‘ â³ å¾…å®ç°

#### 4.1 çŠ¶æ€å­˜å‚¨è¿ç§»

**åŸæ–¹å¼ï¼ˆç‰©å“NBTï¼‰**:
```java
CompoundTag tag = stack.getOrDefault(DataComponents.CUSTOM_DATA,
    CustomData.EMPTY).copyTag();
String ownerUUID = tag.getString("OwnerUUID");
String cloneUUID = tag.getString("CloneUUID");
CompoundTag cloneData = tag.getCompound("CloneData");
```

**æ–°æ–¹å¼ï¼ˆå™¨å®˜çŠ¶æ€ï¼‰**:
```java
OrganState state = OrganState.of(organ, "DuochongjianyingGu");
String ownerUUID = state.getString("OwnerUUID");
String cloneUUID = state.getString("CloneUUID");
CompoundTag cloneData = state.getCompound("CloneData");
```

#### 4.2 æ–¹æ³•è¿ç§»æ˜ å°„

| åŸæ–¹æ³•ï¼ˆDuochongjianyingGuItemï¼‰ | æ–°æ–¹æ³•ï¼ˆå™¨å®˜è¡Œä¸ºï¼‰ | è§¦å‘æ–¹å¼ |
|--------------------------------|------------------|---------|
| `use()` - å³é”® | `activateAbility()` | OrganActivationListeners |
| `use()` - Shift+å³é”® | `activateAbility()` (æ£€æŸ¥Shift) | OrganActivationListeners |
| `isOwnedBy(ItemStack, Player)` | `isOwnedBy(ChestCavityInstance, Player)` | å†…éƒ¨è°ƒç”¨ |
| `summonClone(...)` | `summonClone(...)` | å†…éƒ¨è°ƒç”¨ |
| `recallClone(...)` | `recallClone(...)` | å†…éƒ¨è°ƒç”¨ |
| `findClone(...)` | `findClone(...)` | å†…éƒ¨è°ƒç”¨ |

#### 4.3 éœ€è¦è¿ç§»çš„åŠŸèƒ½æ¨¡å—

- [ ] **æ‰€æœ‰æƒæ ¡éªŒ**: ä»ç‰©å“NBTè¯»å– â†’ ä»å™¨å®˜çŠ¶æ€è¯»å–
- [ ] **åˆ†èº«å¬å”¤**:
  - è¯»å–åˆ†èº«æ•°æ®ï¼ˆOrganStateï¼‰
  - åˆ›å»º `PersistentGuCultivatorClone` å®ä½“
  - ä¿å­˜åˆ†èº«UUIDåˆ°å™¨å®˜çŠ¶æ€
- [ ] **åˆ†èº«å¬å›**:
  - æŸ¥æ‰¾åˆ†èº«å®ä½“
  - åºåˆ—åŒ–åˆ†èº«æ•°æ®
  - ä¿å­˜åˆ°å™¨å®˜çŠ¶æ€
  - ç§»é™¤åˆ†èº«å®ä½“
- [ ] **æ‰“å¼€ç•Œé¢**:
  - æ£€æŸ¥åˆ†èº«å­˜åœ¨
  - æ£€æŸ¥è·ç¦»é™åˆ¶
  - è°ƒç”¨ `clone.openInventoryMenu(player)`
- [ ] **è·¨ç»´åº¦æ”¯æŒ**:
  - P1ä¿®å¤é€»è¾‘è¿ç§»
  - æƒ°æ€§æ¸…ç†æœºåˆ¶
  - UUIDæ‚¬æŒ‚æ£€æµ‹

---

### ç¬¬5æ­¥ï¼šåˆ é™¤æ—§å®ç° â³ å¾…æ‰§è¡Œ
**åˆ é™¤æ–‡ä»¶**: `DuochongjianyingGuItem.java` (460è¡Œ)

**å‰ç½®æ¡ä»¶**:
- [x] æ–°å™¨å®˜è¡Œä¸ºæ¡†æ¶å·²åˆ›å»º
- [ ] æ ¸å¿ƒé€»è¾‘å·²å®Œæ•´è¿ç§»
- [ ] ç¼–è¯‘é€šè¿‡
- [ ] åŸºç¡€æµ‹è¯•é€šè¿‡

**åˆ é™¤åå½±å“**:
- âœ… **æ— å½±å“**: åˆ†èº«å®ä½“ç³»ç»Ÿï¼ˆPersistentGuCultivatorCloneï¼‰
- âœ… **æ— å½±å“**: åˆ†èº«UIç³»ç»Ÿï¼ˆCloneInventoryMenu + Screenï¼‰
- âœ… **æ— å½±å“**: å¢ç›Šç³»ç»Ÿï¼ˆCloneBoostItemRegistryï¼‰
- âœ… **æ— å½±å“**: å®¹å™¨å’ŒScreenæ³¨å†Œ

---

### ç¬¬6æ­¥ï¼šæ–‡æ¡£æ›´æ–° â³ è¿›è¡Œä¸­

#### å·²æ›´æ–° âœ…
- [x] `é˜¶æ®µæ€»è§ˆ.md` - æ·»åŠ é‡æ„é€šçŸ¥ç« èŠ‚
- [x] `æ¶æ„é‡æ„_ç‰©å“åˆ°å™¨å®˜_2025-11-14.md` (æœ¬æ–‡æ¡£)

#### å¾…æ›´æ–° â¸ï¸
- [ ] `å¤šé‡å‰‘å½±è›Š_å®ç°è®¡åˆ’_v2_ä¿®è®¢ç‰ˆ.md` - æ›´æ–°ä¸ºå™¨å®˜æ¨¡å¼
- [ ] `å¤šé‡å‰‘å½±è›Š_å®Œæ•´å®ç°è®¡åˆ’.md` - æ·»åŠ é‡æ„è¯´æ˜
- [ ] `é˜¶æ®µ1éªŒæ”¶æŠ¥å‘Š.md` - è¯´æ˜æ¶æ„å˜æ›´
- [ ] `é˜¶æ®µ2_å®Œæˆæ€»ç»“.md` - æ ‡æ³¨é‡æ„åºŸå¼ƒ
- [ ] `é˜¶æ®µ3_å®Œæˆæ€»ç»“.md` - è¯´æ˜UIç³»ç»Ÿä»ç„¶æœ‰æ•ˆ
- [ ] `é˜¶æ®µ4_å¢ç›Šç³»ç»Ÿ_å®Œæˆæ€»ç»“.md` - è¯´æ˜å¢ç›Šç³»ç»Ÿä»ç„¶æœ‰æ•ˆ

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### åˆ é™¤ä»£ç 
- `DuochongjianyingGuItem.java`: -460è¡Œ

### æ–°å¢ä»£ç 
- `DuochongjianyingGuOrganBehavior.java`: +150è¡Œï¼ˆé¢„ä¼°ï¼Œå¾…å®ç°ï¼‰
- `CCItems.java`: +3è¡Œï¼ˆå¤–éƒ¨å¼•ç”¨ï¼‰
- `JiandaoOrganRegistry.java`: +6è¡Œï¼ˆæ³¨å†Œï¼‰

### ä¿®æ”¹ä»£ç 
- `é˜¶æ®µæ€»è§ˆ.md`: +50è¡Œï¼ˆé‡æ„è¯´æ˜ï¼‰
- å…¶ä»–æ–‡æ¡£: å¾…ç»Ÿè®¡

### å‡€å˜åŒ–
- ä»£ç : çº¦ -300è¡Œï¼ˆç®€åŒ–ï¼‰
- æ–‡æ¡£: çº¦ +200è¡Œï¼ˆè¯´æ˜ï¼‰

---

## ğŸ¯ ä¿ç•™çš„æ¨¡å—ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

ä»¥ä¸‹æ¨¡å—åœ¨é‡æ„å**ç»§ç»­æœ‰æ•ˆ**ï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨ï¼š

### 1. åˆ†èº«å®ä½“ç³»ç»Ÿ âœ…
**æ–‡ä»¶**: `entity/PersistentGuCultivatorClone.java` (çº¦700è¡Œ)

**åŠŸèƒ½**:
- åˆ†èº«å®ä½“é€»è¾‘
- è·¨ç»´åº¦æŒä¹…åŒ–
- æ‰€æœ‰æƒæ ¡éªŒ
- ç‰©å“æ ç®¡ç† (7æ§½ä½)
- å¢ç›Šæ•ˆæœåº”ç”¨
- AIé€‚é…å™¨ï¼ˆé˜¶æ®µ5ï¼‰

**è¯´æ˜**: å™¨å®˜è¡Œä¸ºåªæ˜¯**è§¦å‘æ–¹å¼**çš„å˜åŒ–ï¼Œåˆ†èº«å®ä½“æœ¬èº«çš„é€»è¾‘å®Œå…¨ç‹¬ç«‹ã€‚

---

### 2. åˆ†èº«UIç³»ç»Ÿ âœ…
**æ–‡ä»¶**:
- `ui/CloneInventoryMenu.java` (270è¡Œ) - å®¹å™¨èœå•
- `client/CloneInventoryScreen.java` (110è¡Œ) - GUIæ¸²æŸ“

**åŠŸèƒ½**:
- 7æ§½ä½ç•Œé¢ï¼ˆ6è›Šè™« + 1å¢ç›Šï¼‰
- Shift-Clickå¿«é€Ÿç§»åŠ¨
- æ‰€æœ‰æƒæ ¡éªŒ
- å®¢æˆ·ç«¯æ¸²æŸ“

**è¯´æ˜**: æ‰“å¼€ç•Œé¢çš„**è§¦å‘æ–¹å¼**æ”¹å˜ï¼ˆä»å³é”®ç‰©å“ â†’ ä¸»åŠ¨æŠ€èƒ½+Shiftï¼‰ï¼Œä½†ç•Œé¢æœ¬èº«çš„å®ç°æ— éœ€ä¿®æ”¹ã€‚

---

### 3. å¢ç›Šç³»ç»Ÿ âœ…
**æ–‡ä»¶**:
- `CloneBoostItemRegistry.java` (çº¦200è¡Œ)
- `ICloneBoostEffect.java` (96è¡Œ)

**åŠŸèƒ½**:
- å¢ç›Šç‰©å“æ³¨å†Œ
- å¢ç›Šæ•ˆæœæ¥å£
- ç¤ºä¾‹å¢ç›Šï¼ˆé’»çŸ³ã€å‡‹é›¶éª·é«…å¤´ã€ä¸‹ç•Œä¹‹æ˜Ÿï¼‰
- ç”Ÿå‘½å‘¨æœŸç®¡ç†

**è¯´æ˜**: å¢ç›Šç³»ç»Ÿä¸ç‰©å“/å™¨å®˜è§¦å‘æ–¹å¼æ— å…³ï¼Œåªå…³å¿ƒåˆ†èº«å®ä½“çš„çŠ¶æ€ã€‚

---

### 4. æ³¨å†Œç³»ç»Ÿ âœ…
**æ–‡ä»¶**:
- `CCEntities.java` - åˆ†èº«å®ä½“æ³¨å†Œ
- `CCContainers.java` - å®¹å™¨æ³¨å†Œ
- `ChestCavity.java` - Capabilitiesæ³¨å†Œ
- `ChestCavityClientEvents.java` - Screenæ³¨å†Œ

**è¯´æ˜**: è¿™äº›æ³¨å†Œä¸ç‰©å“ç±»æ— å…³ï¼Œåªä¸å®ä½“ã€å®¹å™¨ã€UIæœ‰å…³ã€‚

---

## âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹

### é«˜é£é™©åŒºåŸŸ
1. **çŠ¶æ€è¿ç§»**: OrganStateä¸ç‰©å“NBTçš„APIå·®å¼‚
   - **é£é™©**: æ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–é”™è¯¯
   - **ç¼“è§£**: å……åˆ†æµ‹è¯•NBTè¯»å†™é€»è¾‘

2. **è·¨ç»´åº¦æ”¯æŒ**: P1ä¿®å¤é€»è¾‘çš„æ­£ç¡®è¿ç§»
   - **é£é™©**: UUIDæ‚¬æŒ‚ã€èµ„æºæ³„æ¼
   - **ç¼“è§£**: ä¿ç•™åŸæœ‰çš„æƒ°æ€§æ¸…ç†æœºåˆ¶

3. **ä¸»åŠ¨æŠ€èƒ½è§¦å‘**: OrganActivationListenersçš„è°ƒç”¨æ—¶æœº
   - **é£é™©**: ç©å®¶æ— æ³•è§¦å‘æˆ–é¢‘ç¹è§¦å‘
   - **ç¼“è§£**: å‚è€ƒ `JianYingGuOrganBehavior` çš„å®ç°

### æµ‹è¯•é‡ç‚¹
- [ ] åˆ†èº«å¬å”¤ï¼ˆä»å™¨å®˜çŠ¶æ€æ¢å¤æ•°æ®ï¼‰
- [ ] åˆ†èº«å¬å›ï¼ˆä¿å­˜æ•°æ®åˆ°å™¨å®˜çŠ¶æ€ï¼‰
- [ ] Shift+è§¦å‘æ‰“å¼€ç•Œé¢
- [ ] æ‰€æœ‰æƒæ ¡éªŒï¼ˆä»èƒ¸è…”æ‰€æœ‰è€…åˆ¤æ–­ï¼‰
- [ ] è·¨ç»´åº¦ä¼ é€ååˆ†èº«çŠ¶æ€
- [ ] å™¨å®˜è¢«ç§»é™¤åçš„èµ„æºæ¸…ç†

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

### åŒç±»å™¨å®˜å®ç°
- `JianYingGuOrganBehavior.java` - å‰‘å½±è›Šï¼ˆä¸»åŠ¨æŠ€èƒ½ç¤ºä¾‹ï¼‰
- `JianYinGuOrganBehavior.java` - å‰‘å¼•è›Šï¼ˆçŠ¶æ€ç®¡ç†ç¤ºä¾‹ï¼‰

### æ¶æ„æ–‡æ¡£
- `DAO_REFACTORING_GUIDE.md` - é“ç³»ç»Ÿé‡æ„æŒ‡å—
- `å¤šé‡å‰‘å½±è›Š_å®ç°è®¡åˆ’_v2_ä¿®è®¢ç‰ˆ.md` - åŸå®ç°è®¡åˆ’ï¼ˆå¾…æ›´æ–°ï¼‰

### APIæ–‡æ¡£
- `OrganState` - å™¨å®˜çŠ¶æ€API
- `OrganActivationListeners` - ä¸»åŠ¨æŠ€èƒ½ç›‘å¬å™¨
- `OrganIntegrationSpec` - å™¨å®˜é›†æˆè§„èŒƒ

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³ä»»åŠ¡
1. â³ å®ç° `DuochongjianyingGuOrganBehavior` çš„å®Œæ•´é€»è¾‘
   - è¿ç§»å¬å”¤/å¬å›é€»è¾‘
   - å®ç°OrganStateçŠ¶æ€ç®¡ç†
   - å®ç°ä¸»åŠ¨æŠ€èƒ½Shiftæ£€æµ‹

2. â¸ï¸ åˆ é™¤ `DuochongjianyingGuItem.java`
   - å‰ç½®ï¼šç¡®ä¿æ–°å®ç°ç¼–è¯‘é€šè¿‡
   - å‰ç½®ï¼šåŸºç¡€åŠŸèƒ½æµ‹è¯•é€šè¿‡

3. â¸ï¸ æ›´æ–°æ‰€æœ‰é˜¶æ®µæ–‡æ¡£
   - æ ‡æ³¨å“ªäº›å†…å®¹å·²åºŸå¼ƒ
   - è¯´æ˜å“ªäº›æ¨¡å—ä»ç„¶æœ‰æ•ˆ

### é•¿æœŸè§„åˆ’
- ç»§ç»­é˜¶æ®µ5ï¼ˆAIé€‚é…å™¨ï¼‰çš„å®ç°
- ç»§ç»­é˜¶æ®µ6ï¼ˆæµ‹è¯•ä¸ä¿®å¤ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-14
**æœ€åæ›´æ–°**: 2025-11-14
**ä½œè€…**: Claude (Sonnet 4.5)
**çŠ¶æ€**: ğŸŸ¡ æ¡†æ¶å®Œæˆï¼Œé€»è¾‘å¾…å®ç°
**ä¼°è®¡å·¥ä½œé‡**: å‰©ä½™2-3å°æ—¶ï¼ˆé€»è¾‘è¿ç§» + æµ‹è¯•ï¼‰
