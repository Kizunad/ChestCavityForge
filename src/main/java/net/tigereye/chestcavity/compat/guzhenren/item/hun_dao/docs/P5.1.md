# Hun Dao Phase 5.1 修复计划

## 背景
Phase 5 merge 后在审查中发现两项阻断性缺陷，会导致 FX/Client 状态体系实装失效：
1. 服务器侧从未初始化 FX Registry，所有 FX 调度都会被 HunDaoFxRouter 拒绝；
2. 客户端事件总线未注册，HunDaoClientState/HUD/通知 tick 永远不会运行。

## 修复目标
- 确保 FX 模板在服务端与客户端均完成注册，HunDaoFxRouter 可以获取模板；
- 将 HunDaoClientEvents/HunDaoSoulHud/HunDaoNotificationRenderer 正确挂载到 NeoForge 客户端事件，确保状态衰减、卸载清理、通知渲染得以执行。

## 任务拆分
1. **FX 初始化修复**
   - 在共有初始化路径（如 `HunDaoOrganRegistry::init` 或 mod 主类）调用 `HunDaoFxInit.init()`；
   - 或者为 `HunDaoFxInit` 添加 `ServerLifecycleEvents` 钩子，保证 dedicated server 也会注册模板；
   - 自检：`HunDaoFxRegistry.size() > 0` 且服务器日志不再出现 `FX template not registered`。
2. **客户端事件注册**
   - 给 `HunDaoClientEvents` 添加 `@EventBusSubscriber(value = Dist.CLIENT, modid = ChestCavity.MODID)` 或在 `HunDaoClientAbilities#onClientSetup` 中 `NeoForge.EVENT_BUS.register(HunDaoClientEvents.class)`；
   - 若 HUD/通知需要渲染钩子，补充 `NeoForge.EVENT_BUS.addListener(RenderGuiEvent.Post, ...)`；
   - 自检：`HunDaoClientState.tick()` 经由日志/调试确认每 tick 运行。
3. **验证**
   - 重新跑 `./gradlew compileJava`；
   - 启动客户端进行烟测，确认魂兽/Gui Wu FX 实际播放、HUD 状态随时间衰减；
   - 更新 `Phase5_Report.md` 说明修复与验证结果（可追加 Phase5.1_Report）。

## 预期交付
- 修复提交（含 FX 初始化 & 客户端事件注册）；
- 如需补文档，新增 `Phase5.1_Report.md`；
- 自检记录附在报告末尾。
