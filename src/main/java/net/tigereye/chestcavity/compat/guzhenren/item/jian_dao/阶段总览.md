# 多重剑影蛊 - 阶段总览

## 📊 整体进度

| 阶段 | 状态 | 工作量 | 完成日期 | 文档 |
|------|------|--------|---------|------|
| **阶段1: 核心实体开发** | ✅ 已完成 | 1周 | 2025-11-14 | [验收报告](阶段1验收报告.md) |
| **阶段2: 物品与交互** | ⏳ 进行中 | 3天 | - | [任务清单](阶段2_物品与交互_任务清单.md) |
| **阶段3: 界面系统 + Capabilities** | ⏸️ 待开始 | 5天 | - | [Capabilities方案](Capabilities_API集成方案.md) |
| **阶段4: 增益系统** | ⏸️ 待开始 | 2天 | - | 计划v2.1 |
| **阶段5: AI适配器** | ⏸️ 待开始 | 2天 | - | 计划v2.1 |
| **阶段6: 测试与修复** | ⏸️ 待开始 | 3天 | - | 计划v2.1 |

**总体进度**: 16.7% (1/6阶段完成)

---

## 🎯 当前焦点: 阶段2 (物品与交互)

### 核心目标
创建 `DuochongjianyingGuItem` 物品,实现:
- ✅ 右键召唤/召回分身
- ✅ Shift+右键打开界面 (占位,阶段3实现GUI)
- ✅ 所有权绑定与校验
- ✅ 跨维度场景处理

### 主要交付物
1. **`DuochongjianyingGuItem.java`** (~300-400行)
   - `use()` 方法 (核心交互)
   - `summonClone()` / `recallClone()` 方法
   - `isOwnedBy()` / `findClone()` 辅助方法

2. **注册与资源**
   - 在 `CCItems.java` 注册物品
   - 添加中文本地化 (zh_cn.json)
   - (可选) 物品模型与纹理

### 详细任务
参见 → [阶段2_物品与交互_任务清单.md](阶段2_物品与交互_任务清单.md)

---

## 📚 关键文档索引

### 规划文档
- **[多重剑影蛊_实现计划_v2_修订版.md](多重剑影蛊_实现计划_v2_修订版.md)** - 完整实施计划 (v2.1)
- **[Capabilities_API集成方案.md](Capabilities_API集成方案.md)** - NeoForge 1.21.1 能力系统集成方案

### 阶段文档
- **[阶段1验收报告.md](阶段1验收报告.md)** - 核心实体开发验收
- **[阶段2_物品与交互_任务清单.md](阶段2_物品与交互_任务清单.md)** ← **当前阶段**

### 代码文件
#### 已完成 (阶段1)
- `entity/PersistentGuCultivatorClone.java` (633行) - 核心实体
- `client/PersistentGuCultivatorCloneRenderer.java` (138行) - 渲染器
- `CCEntities.java` (更新) - 实体注册

#### 待实现 (阶段2)
- `DuochongjianyingGuItem.java` - 物品类
- `CCItems.java` (更新) - 物品注册

---

## 🔑 关键决策记录

### v2.1 新增 (2025-11-14)
1. **Capabilities API正确集成方案**
   - 问题: `Entity.getCapability()` 在 NeoForge 1.21.1 为 final 方法
   - 解决: 使用 `RegisterCapabilitiesEvent` + `VanillaContainerWrapper`
   - 实施: 阶段3添加 `getContainerView()` 和 `registerCapabilities()`

2. **阶段1验收发现**
   - 实体已完整实现 (633行)
   - 渲染器已完成 (138行)
   - 临时方案: `getInventory()` 公共方法

### v2.0 修订 (评审后)
1. **MVP去除胸腔复制** - 降低复杂度
2. **专用物品序列化** - 避免生命周期方法复用
3. **Shift优先处理** - 修正交互一致性
4. **AI分频执行** - 性能优化 (每3 tick)

---

## 🚀 下一步行动

### 立即开始 (阶段2)
1. 创建 `DuochongjianyingGuItem.java` 文件
2. 实现 `use()` 核心交互逻辑
3. 实现召唤/召回方法
4. 注册物品到 `CCItems.java`
5. 测试基础召唤/召回流程

### 准备工作 (阶段3)
- 复习 Capabilities API 集成方案
- 设计GUI布局 (7槽位)
- 准备纹理资源

---

## ⚠️ 已知问题与风险

### 阶段1遗留
- ⚠️ **Capabilities API未集成** (推迟到阶段3)
  - 临时方案: `getInventory()` 直接访问
  - 完整方案: 参见 `Capabilities_API集成方案.md`

### 阶段2潜在风险
- 快速重复点击可能生成多个分身 (需防抖)
- 跨维度场景需要清晰用户提示
- 分身死亡后的清理逻辑

---

## 📞 协作与支持

### 获取帮助
- 查看详细任务清单: `阶段2_物品与交互_任务清单.md`
- 参考阶段1实现: `PersistentGuCultivatorClone.java`
- 查看Capabilities方案: `Capabilities_API集成方案.md`

### 反馈问题
- 记录到对应阶段文档的"已知问题"章节
- 更新本文档的"已知问题与风险"

---

**最后更新**: 2025-11-14
**当前版本**: v2.1
**总体状态**: 🟢 健康 (阶段1完成,阶段2进行中)
